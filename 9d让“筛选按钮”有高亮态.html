<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„ç¬¬ä¸€ä¸ªå¾…åŠé¡µé¢</title>

  <style>
    :root{
      --blue:#3498db;
      --blue-d:#2980b9;
      --bg:#f5f7fa;
      --muted:#777;
      --red:#e74c3c;
      --red-d:#c0392b;
      --text:#333;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      line-height:1.6; padding:20px;
    }
    /* å¤–å±‚å®¹å™¨ï¼ˆå¡ç‰‡å£³ï¼‰ */
    .container-panel{
      max-width:840px; margin:0 auto; background:#fff;
      border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.06);
      padding:22px;
    }
    h1{ margin:0 0 14px; font-size:24px; color:#2c3e50; }

    /* é¡¶éƒ¨â€œæ·»åŠ ä»»åŠ¡â€è¡Œ */
    .row{ display:flex; gap:8px; flex-wrap:wrap; margin:12px 0 8px; }
    .row input[type="text"]{
      flex:1; min-width:240px; padding:10px 12px; border:1px solid #ddd; border-radius:8px;
    }
    .row select{
      padding:10px 12px; border:1px solid #ddd; border-radius:8px;
    }
    .btn{
      padding:10px 14px; border:0; border-radius:8px; background:var(--blue); color:#fff; cursor:pointer;
      transition:background .2s ease;
    }
    .btn:hover{ background:var(--blue-d); }

    /* åˆ†ç±»ç­›é€‰æŒ‰é’®åŒº */
    #filters{ display:flex; gap:8px; flex-wrap:wrap; margin:12px 0; }
    #filters button{
      padding:8px 12px; border:1px solid #ddd; border-radius:20px; background:#fff; cursor:pointer;
      transition: all .2s ease;
    }
    #filters button:hover{ transform:translateY(-1px); }
    #filters button.is-active{ background:var(--blue); color:#fff; border-color:var(--blue); }

    /* è‡ªå®šä¹‰åˆ†ç±»è¡Œï¼ˆè¾“å…¥ + chipså±•ç¤ºï¼‰ */
    #customCatForm{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0; }
    #customCats{ display:flex; gap:6px; flex-wrap:wrap; margin:6px 0 12px; color:var(--muted); }
    .chip{
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:16px; background:#eee;
    }
    .chip .chip-del{
      background:var(--red); color:#fff; border:0; border-radius:12px; padding:2px 8px; cursor:pointer;
    }
    .chip .chip-del:hover{ background:var(--red-d); }

    /* ä»»åŠ¡åˆ—è¡¨å¡ç‰‡åŒ– */
    #taskList{ list-style:none; padding-left:0; margin:14px 0; }
    #taskList li{
      display:flex; align-items:center; gap:10px; padding:12px; margin-bottom:10px;
      background:#f8f9fa; border-radius:10px; border-left:4px solid var(--blue);
      box-shadow: 0 2px 6px rgba(0,0,0,.05); transition: transform .15s ease, box-shadow .15s ease;
    }
    #taskList li:hover{ transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.08); }

    /* æ–‡æœ¬å®Œæˆæ€ç”¨ç±»åæ§åˆ¶ï¼ˆæ¯”è¡Œå†…æ ·å¼å¹²å‡€ï¼‰ */
    .task-text{ flex:1; word-break: break-word; }
    .task-text.completed{ text-decoration:line-through; color:var(--muted); }

    /* åˆ é™¤æŒ‰é’® */
    .btn-del{
      font-size:12px; padding:6px 10px; border:0; border-radius:6px; background:var(--red); color:#fff; cursor:pointer;
      transition: background .2s ease;
    }
    .btn-del:hover{ background:var(--red-d); }

    /* ç»Ÿè®¡è¡Œ */
    #stats, #statsCurrent{ color:#555; margin:6px 0; }

    /* ç©ºæ€ */
    .empty{ color:var(--muted); text-align:center; padding:24px 8px; }

    /* å“åº”å¼æ”¶æ•› */
    @media (max-width:600px){
      .row{ flex-direction:column; }
    }
  </style>

  </head>
  <body>
    <div class="container-panel">
      <h1>ğŸ“‹ åˆ†ç±»å¾…åŠäº‹é¡¹</h1>
      
      <!-- æ·»åŠ ä»»åŠ¡çš„åŒºåŸŸ -->
      <div class="row">
        <input type="text" id="taskInput" placeholder="è¾“å…¥æ–°çš„å¾…åŠäº‹é¡¹â€¦â€¦">

        <!-- æ–°å¢ï¼šåˆ†ç±»é€‰æ‹© -->
        <select id="categorySelect">
          <option value="å·¥ä½œ">å·¥ä½œ</option>
          <option value="å­¦ä¹ ">å­¦ä¹ </option>
          <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
          <option value="è´­ç‰©">è´­ç‰©</option>
          <option value="å…¶ä»–">å…¶ä»–</option>
        </select>

        <button id="addButton" class="btn">æ·»åŠ ä»»åŠ¡</button>
      </div>

      <!-- æ–°å¢ï¼šåˆ†ç±»ç­›é€‰æ ‡ç­¾ -->
      <div id="filters">
        <button data-filter="å…¨éƒ¨">å…¨éƒ¨</button>
        <button data-filter="å·¥ä½œ">å·¥ä½œ</button>
        <button data-filter="å­¦ä¹ ">å­¦ä¹ </button>
        <button data-filter="ç”Ÿæ´»">ç”Ÿæ´»</button>
        <button data-filter="è´­ç‰©">è´­ç‰©</button>
        <button data-filter="å…¶ä»–">å…¶ä»–</button>
      </div>

      <!-- è‡ªå®šä¹‰åˆ†ç±»ï¼šæ–°å¢è¡¨å• -->
      <div id="customCatForm">
        <input type="text" id="newCategoryInput" placeholder="è¾“å…¥æ–°åˆ†ç±»åç§°">
        <button id="addCategoryBtn">æ·»åŠ åˆ†ç±»</button>
      </div>

      <!-- è‡ªå®šä¹‰åˆ†ç±»ï¼šå±•ç¤ºåŒºï¼ˆç¨åç”¨ JS å¡«å†…å®¹ï¼‰ -->
      <div id="customCats">æš‚æ— è‡ªå®šä¹‰åˆ†ç±»</div>

      <div id="currentFilter">å½“å‰ç­›é€‰ï¼šå…¨éƒ¨</div>

      <!-- æ˜¾ç¤ºä»»åŠ¡çš„åŒºåŸŸ -->
      <ul id="taskList">
        <!-- å°†æ¥ä»»åŠ¡ä¼šå‡ºç°åœ¨è¿™é‡Œ -->
      </ul>

      <!-- ç»Ÿè®¡æ˜¾ç¤º -->
      <div id="stats">æ€»æ•°ï¼š0 ï½œ å·²å®Œæˆï¼š0</div>
    </div>

    <script>
      // â€”â€” åº”ç”¨çŠ¶æ€ï¼ˆå”¯ä¸€çœŸç›¸ï¼‰â€”â€”
      let tasks = []; // æ¯ä¸ªä»»åŠ¡ï¼š{ id: number, text: string, completed: boolean }
      const STORAGE_KEY = 'my_todos_v1';
      // æ–°å¢ï¼šå½“å‰ç­›é€‰ï¼ˆé»˜è®¤â€œå…¨éƒ¨â€ï¼‰
      let currentFilter = 'å…¨éƒ¨';
      let customCategories = [];
      const STORAGE_KEY_CATS = 'my_todos_cats_v1';
      const RESERVED = new Set(['å…¨éƒ¨','å·¥ä½œ','å­¦ä¹ ','ç”Ÿæ´»','è´­ç‰©','å…¶ä»–']);

      function highlightActiveFilter() {
        const buttons = document.querySelectorAll('#filters button[data-filter]');
        buttons.forEach(btn => {
          if (btn.dataset.filter === currentFilter) btn.classList.add('is-active');
          else btn.classList.remove('is-active');
        });
      }

      function getVisible() {
        return (currentFilter === 'å…¨éƒ¨')
          ? tasks
          : tasks.filter(t => t.category === currentFilter);
      }

      function computeStats(arr) {
        const total = arr.length;
        const done = arr.filter(t => t.completed).length;
        return { total, done };
      }

      function save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
      }

      function updateStats() {
        const statsDiv = document.getElementById('stats');
        const total = tasks.length;
        const done = tasks.filter(t => t.completed).length;
        statsDiv.textContent = `æ€»æ•°ï¼š${total} ï½œ å·²å®Œæˆï¼š${done}`;
      }

      function deleteCustomCategory(cat) {
        if (!customCategories.includes(cat)) return;
        const ok = confirm(`ç¡®å®šåˆ é™¤åˆ†ç±»ã€Œ${cat}ã€å—ï¼Ÿ\nè¯¥åˆ†ç±»ä¸‹çš„ä»»åŠ¡å°†è‡ªåŠ¨ç§»åŠ¨åˆ°ã€Œå…¶ä»–ã€ã€‚`);
        if (!ok) return;

        // 1) ä»è‡ªå®šä¹‰åˆ†ç±»åˆ—è¡¨ç§»é™¤
        customCategories = customCategories.filter(c => c !== cat);
        saveCats();

        // 2) è¿ç§»ä»»åŠ¡ï¼šå‡¡æ˜¯è¿™ä¸ªåˆ†ç±»çš„ï¼Œæ”¹æˆâ€œå…¶ä»–â€
        let changed = false;
        tasks = tasks.map(t => {
          if (t.category === cat) {
            changed = true;
            return { ...t, category: 'å…¶ä»–' };
          }
          return t;
        });
        if (changed) save();

        // 3) å¦‚æœå½“å‰å°±åœ¨è¿™ä¸ªåˆ†ç±»çš„ç­›é€‰é‡Œï¼Œåˆ‡å›â€œå…¨éƒ¨â€
        if (currentFilter === cat) currentFilter = 'å…¨éƒ¨';

        // 4) ç»Ÿä¸€é‡æ¸²æŸ“
        renderFilters();
        render();
      }

      function renderFilters() {
        // 1) ç»™â€œæ·»åŠ ä»»åŠ¡â€çš„ä¸‹æ‹‰ select è¿½åŠ è‡ªå®šä¹‰åˆ†ç±»
        const select = document.getElementById('categorySelect');

        // å›ºå®šé€‰é¡¹ï¼ˆä¿æŒä½ ç°æœ‰é‚£ 5 ä¸ªï¼‰
        const fixedValues = ['å·¥ä½œ','å­¦ä¹ ','ç”Ÿæ´»','è´­ç‰©','å…¶ä»–'];

        // å…ˆé‡å»ºå›ºå®šé¡¹
        select.innerHTML = '';
        fixedValues.forEach(v => {
          const opt = document.createElement('option');
          opt.value = v;
          opt.textContent = v;
          select.appendChild(opt);
        });

        // å†è¿½åŠ è‡ªå®šä¹‰é¡¹
        customCategories.forEach(cat => {
          const opt = document.createElement('option');
          opt.value = cat;
          opt.textContent = cat;
          select.appendChild(opt);
        });

        // 2) æŠŠè‡ªå®šä¹‰åˆ†ç±»æ¸²æŸ“åˆ°å±•ç¤ºåŒºï¼ˆæ¯ä¸ªå¸¦ä¸€ä¸ªåˆ é™¤æŒ‰é’®ï¼‰
        const wrap = document.getElementById('customCats');
        wrap.innerHTML = '';
        if (customCategories.length === 0) {
          wrap.textContent = 'æš‚æ— è‡ªå®šä¹‰åˆ†ç±»';
        } else {
          customCategories.forEach(cat => {
            const holder = document.createElement('span');

            // ç‚¹å‡»åˆ†ç±»åï¼šåˆ‡æ¢ç­›é€‰åˆ°è¯¥åˆ†ç±»
            const gotoBtn = document.createElement('button');
            gotoBtn.textContent = cat;
            gotoBtn.addEventListener('click', () => {
              currentFilter = cat;
              render();
            });

            // åˆ é™¤æŒ‰é’®
            const delBtn = document.createElement('button');
            delBtn.textContent = 'Ã—';
            delBtn.title = `åˆ é™¤åˆ†ç±»ã€Œ${cat}ã€`;
            delBtn.addEventListener('click', () => deleteCustomCategory(cat));

            holder.appendChild(gotoBtn);
            holder.appendChild(delBtn);

            // ç®€å•åŠ ä¸ªç©ºæ ¼åˆ†éš”
            wrap.appendChild(holder);
            wrap.appendChild(document.createTextNode(' '));
          });
        }
      }
      
      function render() {
        list.innerHTML = '';

        // è®¡ç®—å¯è§åˆ—è¡¨
        const visible = getVisible();

        // ç©ºæ€
        if (visible.length === 0) {
          const li = document.createElement('li');
          li.textContent = 'æš‚æ— ä»»åŠ¡ï¼ˆæˆ–å½“å‰åˆ†ç±»ä¸‹æš‚æ— ä»»åŠ¡ï¼‰';
          li.style.color = '#777';
          list.appendChild(li);
        } else {
          // æ¸²æŸ“å¯è§é¡¹
          visible.forEach(task => {
            const li = document.createElement('li');

            const check = document.createElement('input');
            check.type = 'checkbox';
            check.checked = task.completed;

            const span = document.createElement('span');
            span.textContent = `[${task.category}] ${task.text}`;
            if (task.completed) {
              span.style.textDecoration = 'line-through';
              span.style.color = '#777';
            }

            const del = document.createElement('button');
            del.textContent = 'åˆ é™¤';

            check.addEventListener('change', () => {
              task.completed = check.checked;
              save();
              render(); // åªéœ€ render
            });

            del.addEventListener('click', () => {
              tasks = tasks.filter(t => t.id !== task.id);
              save();
              render(); // åªéœ€ render
            });

            li.appendChild(check);
            li.appendChild(span);
            li.appendChild(del);
            list.appendChild(li);
          });
        }

        // æ›´æ–°â€œå½“å‰ç­›é€‰â€æç¤º
        if (currentFilterDiv) {
          currentFilterDiv.textContent = `å½“å‰ç­›é€‰ï¼š${currentFilter}`;
        }

        // â€”â€” ç»Ÿä¸€æ›´æ–°ä¸¤ç§ç»Ÿè®¡ â€”â€” 
        const statsCurrentDiv = document.getElementById('statsCurrent');
        const { total: tc, done: dc } = computeStats(visible);
        if (statsCurrentDiv) {
          statsCurrentDiv.textContent = `å½“å‰åˆ†ç±»ï¼šæ€»æ•°ï¼š${tc} ï½œ å·²å®Œæˆï¼š${dc}`;
        }

        const statsDiv = document.getElementById('stats');
        const { total, done } = computeStats(tasks);
        if (statsDiv) {
          statsDiv.textContent = `æ€»æ•°ï¼š${total} ï½œ å·²å®Œæˆï¼š${done}`;
        }
      }
    
      // è·å–é¡µé¢å…ƒç´ 
      const input = document.getElementById('taskInput'); // è¾“å…¥æ¡†
      const button = document.getElementById('addButton'); // æŒ‰é’®
      const list = document.getElementById('taskList'); // åˆ—è¡¨
      const categorySelect = document.getElementById('categorySelect');
      const currentFilterDiv = document.getElementById('currentFilter');
      const filtersDiv = document.getElementById('filters');


      // ç»™æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶
      button.addEventListener('click', function () {
        const text = input.value.trim();
        if (!text) { alert('è¯·è¾“å…¥å†…å®¹'); return; }

        // å¾€â€œçŠ¶æ€â€é‡ŒåŠ ä¸€æ¡
        tasks.push({
          id: Date.now(),
          text,
          completed: false,
          category: categorySelect.value   // æ–°å¢å­—æ®µ
        });

        // ä¿å­˜ â†’ æ¸²æŸ“
        save();
        render();

        input.value = '';
        input.focus();
      });

      const newCategoryInput = document.getElementById('newCategoryInput');
      const addCategoryBtn = document.getElementById('addCategoryBtn');

      function saveCats() {
        localStorage.setItem(STORAGE_KEY_CATS, JSON.stringify(customCategories));
      }

      addCategoryBtn.addEventListener('click', () => {
        const name = (newCategoryInput.value || '').trim();
        if (!name) { alert('è¯·è¾“å…¥åˆ†ç±»åç§°'); return; }
        if (RESERVED.has(name)) { alert('è¿™æ˜¯ä¿ç•™åˆ†ç±»ï¼Œä¸èƒ½é‡å¤æ·»åŠ '); return; }
        if (customCategories.includes(name)) { alert('è¯¥åˆ†ç±»å·²å­˜åœ¨'); return; }

        customCategories.push(name);
        saveCats();
        renderFilters();  // æ›´æ–°ä¸‹æ‹‰å’Œå±•ç¤ºåŒº
        newCategoryInput.value = '';
      });

      // å›è½¦æ·»åŠ 
      newCategoryInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') addCategoryBtn.click();
      });

      // æŒ‰ Enter ç›´æ¥æ·»åŠ ä»»åŠ¡
      input.addEventListener('keydown', function (e) {
          if (e.key === 'Enter') {
              button.click(); // è§¦å‘â€œæ·»åŠ ä»»åŠ¡â€å’Œåç»­æ¸²æŸ“/ç»Ÿè®¡
          }
      });

      document.addEventListener('DOMContentLoaded', () => {
        // 1) å…ˆä» localStorage è¯»å–
        const raw = localStorage.getItem(STORAGE_KEY);
        tasks = raw ? JSON.parse(raw) : [];

        // è¯»å–è‡ªå®šä¹‰åˆ†ç±»
        try {
          const rawCats = localStorage.getItem(STORAGE_KEY_CATS);
          customCategories = rawCats ? JSON.parse(rawCats) : [];
        } catch {
          customCategories = [];
          localStorage.removeItem(STORAGE_KEY_CATS);
        }
        
        renderFilters();

        // 2) æ¸²æŸ“ + ç»Ÿè®¡
        render();
        // é¡µé¢åŠ è½½å®Œä¹Ÿåˆå§‹åŒ–ä¸€æ¬¡é«˜äº®
        highlightActiveFilter();
      });

      // äº‹ä»¶å§”æ‰˜ï¼šfilters å®¹å™¨é‡Œç‚¹åˆ°å“ªä¸ªæŒ‰é’®éƒ½èƒ½æ‹¿åˆ° data-filter
      filtersDiv.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-filter]');
        if (!btn) return;
        currentFilter = btn.dataset.filter;
        highlightActiveFilter(); // æ–°å¢
        render();
      });

    </script>
  </body>
</html>
