<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <title>ğŸ“‹ åˆ†ç±»å¾…åŠäº‹é¡¹</title>

  <style>
    :root{
      --blue:#3498db;
      --blue-d:#2980b9;
      --bg:#f5f7fa;
      --muted:#777;
      --red:#e74c3c;
      --red-d:#c0392b;
      --text:#333;
    }

    *{ box-sizing:border-box; }
    body{
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 0;
      margin: 0;
      background: linear-gradient(135deg, #dbeafe, #fef9c3);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: var(--text);
    }
    /* å¤–å±‚å®¹å™¨ï¼ˆå¡ç‰‡å£³ï¼‰ */
    .container-panel{
      max-width: 840px;
      margin: 0 auto;
      background: #ffffffcc; /* åŠé€æ˜ç™½ï¼Œè¡¬æ‰˜èƒŒæ™¯ */
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      padding: 32px 24px;
      backdrop-filter: blur(10px); /* å¢åŠ è½»å¾®ç»ç’ƒç£¨ç ‚æ•ˆæœ */
    }

    h1 {
      text-align: center;
      font-size: 30px;
      font-weight: 700;
      color: #1e3a8a;
      margin-bottom: 25px;
      letter-spacing: 0.5px;
    }

    /* é¡¶éƒ¨â€œæ·»åŠ ä»»åŠ¡â€è¡Œ */
    .row{ display:flex; gap:8px; flex-wrap:wrap; margin:12px 0 8px; }
    .row input[type="text"]{
      flex:1; min-width:240px; padding:10px 12px; border:1px solid #ddd; border-radius:8px;
    }
    .row select{
      padding:10px 12px; border:1px solid #ddd; border-radius:8px;
    }
    .btn{
      padding:10px 14px; border:0; border-radius:8px; background:var(--blue); color:#fff; cursor:pointer;
      transition:background .2s ease;
    }
    .btn:hover{ background:var(--blue-d); }

    /* åˆ†ç±»ç­›é€‰æŒ‰é’®åŒº */
    #filters{ display:flex; gap:8px; flex-wrap:wrap; margin:12px 0; }
    #filters button{
      padding:8px 12px; border:1px solid #ddd; border-radius:20px; background:#fff; cursor:pointer;
      transition: all .2s ease;
    }
    #filters button:hover{ transform:translateY(-1px); }
    #filters button.is-active{ background:var(--blue); color:#fff; border-color:var(--blue); }

    /* è‡ªå®šä¹‰åˆ†ç±»è¡Œï¼ˆè¾“å…¥ + chipså±•ç¤ºï¼‰ */
    #customCatForm{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0; }
    #customCats{ display:flex; gap:6px; flex-wrap:wrap; margin:6px 0 12px; color:var(--muted); }
    .chip{
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:16px; background:#eee;
    }
    .chip .chip-del{
      background:var(--red); color:#fff; border:0; border-radius:12px; padding:2px 8px; cursor:pointer;
    }
    .chip .chip-del:hover{ background:var(--red-d); }

    /* ä»»åŠ¡åˆ—è¡¨å¡ç‰‡åŒ– */
    #taskList{ list-style:none; padding-left:0; margin:14px 0; }
    #taskList li{
      display:flex; align-items:center; gap:10px; padding:12px; margin-bottom:10px;
      background:#f8f9fa; border-radius:10px; border-left:4px solid var(--blue);
      box-shadow: 0 2px 6px rgba(0,0,0,.05); transition: transform .15s ease, box-shadow .15s ease;
    }
    #taskList li:hover{ transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.08); }

    /* æ–‡æœ¬å®Œæˆæ€ç”¨ç±»åæ§åˆ¶ï¼ˆæ¯”è¡Œå†…æ ·å¼å¹²å‡€ï¼‰ */
    .task-text{ flex:1; word-break: break-word; }
    .task-text.completed{ text-decoration:line-through; color:var(--muted); }

    /* â€”â€” ä»»åŠ¡åˆ é™¤æŒ‰é’®ï¼ˆå±é™©ä¸»é¢˜ï¼‰ â€”â€” */
    .btn-del{
      position: relative;
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border:0;
      border-radius:999px;
      font-size:13px;
      font-weight:600;
      color:#fff;
      background: linear-gradient(#f05b51, #e1473f); /* çº¢è‰²æ¸å˜ */
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease, background .2s ease;
      box-shadow: 0 4px 12px rgba(225, 71, 63, .35);
    }
    .btn-del::before{
      content: "ğŸ—‘ï¸";
      font-size:14px;
      line-height:1;
    }
    .btn-del:hover{
      transform: translateY(-1px);
      background: linear-gradient(#f46c62, #e44f46);
      box-shadow: 0 8px 18px rgba(225, 71, 63, .45);
    }
    .btn-del:active{
      transform: translateY(0);
      box-shadow: 0 4px 12px rgba(225, 71, 63, .35);
    }
    .btn-del:focus-visible{
      outline:none;
      box-shadow: 0 0 0 3px rgba(228,79,70,.35);
    }

    /* ç»Ÿè®¡è¡Œ */
    #stats, #statsCurrent{ color:#555; margin:6px 0; }

    /* ç©ºæ€ */
    .empty{ color:var(--muted); text-align:center; padding:24px 8px; }

    /* å“åº”å¼æ”¶æ•› */
    @media (max-width:600px){
      .row{ flex-direction:column; }
    }

    /* â€”â€” åˆ†ç±»ç­›é€‰æŒ‰é’®ï¼ˆå¢å¼ºç‰ˆï¼‰ â€”â€” */
    #filters{
      display:flex; gap:10px; flex-wrap:wrap; margin:14px 0;
    }
    #filters button{
      padding:10px 16px;
      border:1px solid #d7e0ea;
      border-radius:999px;
      background: linear-gradient(#ffffff, #f6f9fc);
      color:#1f2937;
      font-weight:600;
      letter-spacing:.2px;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease, background .2s ease, color .2s ease, border-color .2s ease;
      box-shadow: 0 1px 0 rgba(0,0,0,.02), 0 1px 8px rgba(0,0,0,.04) inset;
    }
    #filters button:hover{
      transform: translateY(-1px);
      background: linear-gradient(#ffffff, #eef2f7);
      box-shadow: 0 6px 14px rgba(0,0,0,.08);
    }
    #filters button:active{
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
    }
    #filters button:focus-visible{
      outline: none;
      box-shadow: 0 0 0 3px rgba(52,152,219,.35);
    }

    /* æ¿€æ´»æ€ï¼šè“è‰²èƒ¶å›Š + æŸ”å…‰ */
    #filters button.is-active{
      color:#fff;
      border-color:#2f82c7;
      background: linear-gradient(#3498db, #2d83c3);
      box-shadow: 0 10px 20px rgba(52,152,219,.35), 0 0 0 1px #2f82c7 inset;
      transform: translateY(-1px);
    }
    #filters button.is-active:hover{
      background: linear-gradient(#4aa7e4, #2f89cb);
    }

    /* è‡ªå®šä¹‰åˆ†ç±»è¾“å…¥åŒºï¼ˆè½»å¡ç‰‡ + å›¾æ ‡æ„Ÿ + ç„¦ç‚¹é«˜äº®ï¼‰ */
    .cat-form{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      padding:12px 14px; margin:10px 0 4px;
      background:#ffffffcc; border:1px solid #e5e7eb; border-radius:12px;
      box-shadow:0 4px 16px rgba(0,0,0,.05);
      backdrop-filter: blur(6px);
    }
    .cat-input{
      flex:1; min-width:220px;
      padding:10px 14px 10px 38px; /* å·¦ä¾§ç»™å›¾æ ‡ç•™ç©ºé—´ */
      border:1px solid #d8dee6; border-radius:10px; outline:none;
      background:
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="%2388a" viewBox="0 0 16 16"><path d="M3 2a1 1 0 0 0-1 1v8.586a1 1 0 0 0 1.707.707L6.5 8.5l2.293 2.293a1 1 0 0 0 1.414 0L14 7v5a2 2 0 0 1-2 2H5.5L3 16V3a1 1 0 0 1 1-1h-1z"/></svg>')
          no-repeat 12px center #fff;
      transition: border-color .15s ease, box-shadow .15s ease, background-color .2s ease;
    }
    .cat-input:focus{
      border-color:#93c5fd;
      box-shadow:0 0 0 3px rgba(59,130,246,.25);
    }
    .cat-add{
      padding:10px 14px; border-radius:10px;
      font-weight:600;
    }

    /* æˆåŠŸ/å¤±è´¥çš„å°åŠ¨ç”» */
    @keyframes pulse {
      0%{ box-shadow:0 0 0 0 rgba(52,152,219,.35); }
      100%{ box-shadow:0 0 0 10px rgba(52,152,219,0); }
    }
    .cat-form.flash{ animation:pulse .6s ease-out; }
    @keyframes shake {
      10%,90%{ transform:translateX(-1px) }
      20%,80%{ transform:translateX(2px) }
      30%,50%,70%{ transform:translateX(-4px) }
      40%,60%{ transform:translateX(4px) }
    }
    .cat-input.error{ animation:shake .32s linear; border-color:#fca5a5; }

    /* è‡ªå®šä¹‰åˆ†ç±» chips åˆ—è¡¨å®¹å™¨ */
    .cat-list{ display:flex; flex-wrap:wrap; gap:10px; margin:8px 0 14px; color:#6b7280; }

    /* å•ä¸ª chipï¼šåœ†æ¶¦ + å¾®æµ®åŠ¨ + è½»è¾¹æ¡† */
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 12px; border-radius:999px;
      background:#eef2ff; border:1px solid #dbe4ff;
      transition: transform .12s ease, box-shadow .12s ease, background .2s ease;
    }
    .chip:hover{
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(0,0,0,.08);
      background:#e7f0ff;
    }

    /* chip å·¦è¾¹â€œåˆ†ç±»åæŒ‰é’®â€ */
    .chip .chip-goto{
      border:0; background:transparent; cursor:pointer; color:#1f3b7a; font-weight:600;
    }

    /* æ•°é‡å¾½ç« ï¼ˆæ˜¾ç¤ºè¯¥åˆ†ç±»ä¸‹æœ‰å¤šå°‘ä»»åŠ¡ï¼‰ */
    .chip .chip-badge{
      display:inline-grid; place-items:center;
      min-width:20px; height:20px; padding:0 6px;
      font-size:12px; font-weight:700; color:#1f2937;
      background:#fff; border:1px solid #e2e8f0; border-radius:999px;
    }

    /* å³ä¾§åˆ é™¤ Ã— å°åœ†ç‚¹æŒ‰é’® */
    .chip .chip-del{
      border:0; cursor:pointer; width:22px; height:22px; border-radius:50%;
      display:inline-grid; place-items:center;
      background:#f1f5f9; color:#ef4444; font-weight:700; line-height:1;
      transition: transform .12s ease, background .2s ease, color .2s ease;
    }
    .chip .chip-del:hover{ background:#fee2e2; color:#b91c1c; transform: translateY(-1px); }

    /* ä»»åŠ¡å†…åˆ†ç±»å¾½ç­¾ï¼ˆæ›¿ä»£ [åˆ†ç±»] æ–‡æœ¬ï¼‰ */
    .tag {
      display:inline-flex; align-items:center; gap:6px;
      padding:2px 8px;
      border-radius:999px;
      font-size:12px; font-weight:700;
      line-height:1;
      border:1px solid currentColor;
      opacity:.95;
    }

    /* å°å›¾æ ‡ï¼ˆå¯é€‰ï¼‰ */
    .tag .tag-ico { font-size:13px; line-height:1; }

    /* å›ºå®šåˆ†ç±»é…è‰² */
    .tag-work   { color:#2563eb; background:#dbeafe; border-color:#bfdbfe; } /* å·¥ä½œ */
    .tag-study  { color:#16a34a; background:#dcfce7; border-color:#bbf7d0; } /* å­¦ä¹  */
    .tag-life   { color:#7c3aed; background:#ede9fe; border-color:#ddd6fe; } /* ç”Ÿæ´» */
    .tag-shop   { color:#b45309; background:#fef3c7; border-color:#fde68a; } /* è´­ç‰© */
    .tag-other  { color:#475569; background:#e2e8f0; border-color:#cbd5e1; } /* å…¶ä»– */

    /* è‡ªå®šä¹‰åˆ†ç±»çš„æŸ”å’Œè°ƒè‰²ç›˜ï¼ˆæŒ‰åç§°å“ˆå¸Œåˆ†é…ï¼‰ */
    .tag-c0 { color:#0ea5e9; background:#e0f2fe; border-color:#bae6fd; }
    .tag-c1 { color:#22c55e; background:#dcfce7; border-color:#bbf7d0; }
    .tag-c2 { color:#f59e0b; background:#fef3c7; border-color:#fde68a; }
    .tag-c3 { color:#a855f7; background:#f3e8ff; border-color:#e9d5ff; }
    .tag-c4 { color:#ef4444; background:#fee2e2; border-color:#fecaca; }
    .tag-c5 { color:#06b6d4; background:#cffafe; border-color:#a5f3fc; }

    /* ä»»åŠ¡æ–‡æœ¬ä¸å¾½ç­¾çš„é—´è· */
    .task-line { display:flex; align-items:center; gap:8px; flex:1; }

    /* è®©å·¦ä¾§è¾¹æ¡éšå›ºå®šåˆ†ç±»å˜è‰²ï¼ˆå¯é€‰ï¼‰ */
    #taskList li.cat-å·¥ä½œ { border-left-color:#2563eb; }
    #taskList li.cat-å­¦ä¹  { border-left-color:#16a34a; }
    #taskList li.cat-ç”Ÿæ´» { border-left-color:#7c3aed; }
    #taskList li.cat-è´­ç‰© { border-left-color:#b45309; }
    #taskList li.cat-å…¶ä»– { border-left-color:#475569; }

    /* â€”â€” å¤§æ ‡é¢˜ â€”â€” */
    .page-title{
      position: relative;
      text-align: center;
      font-size: 36px;          /* æ¡Œé¢ç«¯æ›´æœ‰åˆ†é‡ */
      font-weight: 800;
      letter-spacing: .5px;
      margin: 0 0 22px;
      /* æ¸å˜æ–‡å­— */
      background: linear-gradient(90deg, #1e3a8a, #2563eb, #0ea5e9);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      /* è½»å¾®ç«‹ä½“æ„Ÿ */
      text-shadow: 0 2px 12px rgba(30,58,138,.15);
      /* å…¥åœºåŠ¨ç”» */
      animation: titlePop .5s ease-out both;
    }

    /* ç½®äºæ ‡é¢˜ä¸‹æ–¹çš„å½©è‰²ä¸‹åˆ’çº¿ */
    .page-title::after{
      content: "";
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: -10px;
      width: 160px;
      height: 6px;
      border-radius: 999px;
      background: linear-gradient(90deg, #93c5fd, #60a5fa, #38bdf8);
      box-shadow: 0 4px 14px rgba(59,130,246,.35);
    }

    /* ï¼ˆå¯é€‰ï¼‰å‰¯æ ‡é¢˜ */
    .page-subtitle{
      text-align:center;
      margin: 10px 0 18px;
      color: #64748b;
      font-weight: 600;
    }

    /* å°åŠ¨ç”» */
    @keyframes titlePop{
      from { transform: translateY(6px) scale(.98); opacity:.0; }
      to   { transform: translateY(0) scale(1);     opacity:1; }
    }
    @keyframes floatY{
      0%,100%{ transform: translateY(2px); }
      50%    { transform: translateY(-1px); }
    }

    /* ç§»åŠ¨ç«¯å­—å·è‡ªé€‚åº” */
    @media (max-width: 600px){
      .page-title{ font-size: 28px; }
      .page-title::after{ width: 120px; height: 5px; bottom: -8px; }
    }

    /* å…³é—­åŠ¨æ•ˆçš„æ— éšœç¢å¤„ç† */
    @media (prefers-reduced-motion: reduce){
      .page-title, .page-title-emoji{ animation: none; }
    }

    /* ç»Ÿä¸€è¡¨å•å¤–è§‚ï¼šè¾“å…¥æ¡† + ä¸‹æ‹‰æ¡† */
    #taskInput,
    #categorySelect,
    .cat-input {
      height: 40px;                /* ç»Ÿä¸€é«˜åº¦ï¼Œå’ŒæŒ‰é’®å¯¹é½ */
      padding: 10px 12px;
      border: 1px solid #d8dee6;
      border-radius: 10px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,.04);
      transition: border-color .15s ease, box-shadow .15s ease, background .2s ease;
      outline: none;               /* ç”± focus æ ·å¼æ¥ç®¡ */
    }

    /* æ‚¬åœä¸èšç„¦çš„é«˜äº®ï¼ˆå’ŒæŒ‰é’®è“ä¸€è‡´ï¼‰ */
    #taskInput:hover,
    #categorySelect:hover,
    .cat-input:hover {
      border-color: #c7d2fe;
    }

    #taskInput:focus,
    #categorySelect:focus,
    .cat-input:focus {
      border-color: #93c5fd;
      box-shadow: 0 0 0 3px rgba(59,130,246,.25);
    }

    /* å ä½ç¬¦é¢œè‰²æ›´æŸ”å’Œ */
    #taskInput::placeholder,
    .cat-input::placeholder {
      color: #94a3b8;
    }

    /* ç§»é™¤å„æµè§ˆå™¨é»˜è®¤ç®­å¤´ */
    #categorySelect {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      padding-right: 36px; /* ç»™å³ä¾§ç®­å¤´ç•™ç©ºé—´ */
      background-image:
        url("data:image/svg+xml,%3Csvg viewBox='0 0 20 20' fill='%23556' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5.23 7.21a.75.75 0 011.06.02L10 10.17l3.71-2.94a.75.75 0 111.06 1.06l-4.24 3.36a.75.75 0 01-.94 0L5.21 8.29a.75.75 0 01.02-1.08z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;   /* ç®­å¤´ä½ç½® */
      background-size: 16px 16px;
    }

    /* ä¸ºäº†è§†è§‰å±…ä¸­ï¼Œè¡Œé«˜ä¸é«˜åº¦é€‚é… */
    #categorySelect option { padding: 6px; }

    /* æ•´ç»„æ”¶æ‹¢æˆä¸€ä¸ªâ€œè¾“å…¥é¢æ¿â€æ„Ÿè§‰ï¼ˆä¸æ”¹ HTMLï¼‰ */
    .row {
      background: #ffffffcc;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
      backdrop-filter: blur(6px);
    }

    /* æ§ä»¶é—´è·æ›´å‡åŒ€ */
    .row > * { margin: 0; }

    /* ç©ºæ€å¡ç‰‡ */
    .empty{
      display: grid;
      place-items: center;
      gap: 6px;
      color: #64748b;
      background: #ffffffcc;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 22px 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,.06) inset, 0 2px 10px rgba(0,0,0,.04);
    }

    /* åŠ ä¸€ä¸ªæ·¡æ·¡çš„ emoji å›¾æ ‡ï¼ˆçº¯ CSS ä¼ªå…ƒç´ ï¼Œæ— éœ€æ”¹ JSï¼‰ */
    .empty::before{
      content: "ğŸ“";
      font-size: 18px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.08));
    }

    /* è®©åŸç”Ÿ select è—èµ·æ¥ä½†ä¿ç•™å¯è®¿é—®æ€§ï¼ˆå¯ tab åˆ°æŒ‰é’®ï¼‰ */
    .select-hidden {
      position: absolute !important;
      left: -9999px !important;
      width: 1px; height: 1px; overflow: hidden;
    }

    /* é€‰æ‹©å™¨å®¹å™¨ */
    .cat-picker { position: relative; }

    /* é€‰æ‹©å™¨æŒ‰é’®ï¼ˆå’Œä½ çš„æŒ‰é’®/è¾“å…¥ç»Ÿä¸€é£æ ¼ï¼‰ */
    .cat-picker-btn{
      height: 40px; display: inline-flex; align-items: center; gap: 8px;
      padding: 0 12px; border: 1px solid #d8dee6; border-radius: 10px;
      background: #fff; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,.04);
      transition: border-color .15s ease, box-shadow .15s ease, background .2s ease;
    }
    .cat-picker-btn:hover{ border-color:#c7d2fe; }
    .cat-picker-btn:focus-visible{ outline: none; box-shadow: 0 0 0 3px rgba(59,130,246,.25); }

    /* å½“å‰é€‰æ‹©å±•ç¤ºï¼šç”¨å°å½©è‰²åœ†ç‚¹ + æ–‡æœ¬ */
    .cat-dot{
      width: 10px; height: 10px; border-radius: 50%;
      border: 1px solid currentColor; opacity: .9;
    }
    .cat-label{ font-weight: 700; color:#1f2937; }
    .cat-caret{
      margin-left: 6px; width: 0; height: 0;
      border-left: 5px solid transparent; border-right: 5px solid transparent;
      border-top: 6px solid #64748b;
    }

    /* å¼¹å‡ºèœå• */
    .cat-menu{
      position: absolute; z-index: 20; top: 46px; left: 0;
      min-width: 160px; max-height: 240px; overflow: auto;
      background: #fff; border: 1px solid #e5e7eb; border-radius: 12px;
      box-shadow: 0 12px 30px rgba(0,0,0,.12);
      padding: 6px; display: none;
    }
    .cat-menu.show{ display: block; }

    /* æ¯ä¸€é¡¹ */
    .cat-option{
      display: flex; align-items: center; gap: 8px;
      padding: 8px 10px; border-radius: 10px; cursor: pointer;
      transition: background .15s ease;
    }
    .cat-option:hover{ background: #f1f5f9; }
    .cat-option.active{ background: #e0f2fe; }

    /* ç”¨ tag çš„é…è‰²æ¥ç»™åœ†ç‚¹ç€è‰²ï¼ˆæ²¿ç”¨ä½ å·²æœ‰çš„é…è‰²ç±»ï¼‰ */
    .cat-dot.tag-work   { color:#2563eb; background:#dbeafe; }
    .cat-dot.tag-study  { color:#16a34a; background:#dcfce7; }
    .cat-dot.tag-life   { color:#7c3aed; background:#ede9fe; }
    .cat-dot.tag-shop   { color:#b45309; background:#fef3c7; }
    .cat-dot.tag-other  { color:#475569; background:#e2e8f0; }
    /* è‡ªå®šä¹‰åˆ†ç±» 6 è‰²ç›˜ */
    .cat-dot.tag-c0 { color:#0ea5e9; background:#e0f2fe; }
    .cat-dot.tag-c1 { color:#22c55e; background:#dcfce7; }
    .cat-dot.tag-c2 { color:#f59e0b; background:#fef3c7; }
    .cat-dot.tag-c3 { color:#a855f7; background:#f3e8ff; }
    .cat-dot.tag-c4 { color:#ef4444; background:#fee2e2; }
    .cat-dot.tag-c5 { color:#06b6d4; background:#cffafe; }

    /* è®©é€‰æ‹©å™¨è‡ªèº«å»ºç«‹æ›´é«˜çš„å±‚å ä¸Šä¸‹æ–‡ */
    .cat-picker { position: relative; z-index: 200; }

    /* èœå•æ”¾åœ¨æ‰€æœ‰é¢æ¿/blur ä¹‹ä¸Š */
    .cat-menu { z-index: 9999; }

    /* é»˜è®¤å‘ä¸‹ */
    .cat-menu { top: 46px; bottom: auto; }

    /* éœ€è¦å‘ä¸Šå±•å¼€æ—¶ */
    .cat-menu.drop-up { top: auto; bottom: 46px; }

    /* è®©å¡ç‰‡å®¹å™¨å»ºç«‹å®šä½ä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼Œç¨³å¦¥ï¼‰ */
    .container-panel { position: relative; }

    /* é¡¶éƒ¨â€œæ·»åŠ ä»»åŠ¡â€è¡Œæ•´ä½“å±‚çº§æ›´é«˜ */
    .row{
      position: relative;   /* å…³é”®ï¼šå‚ä¸ z-index æ¯”è¾ƒ */
      z-index: 5;
    }

    /* è‡ªå®šä¹‰åˆ†ç±»è¡¨å•å±‚çº§æ”¾ä½ä¸€äº›ï¼ˆä»å¯æ­£å¸¸æ˜¾ç¤ºï¼‰ */
    .cat-form{
      position: relative;   /* åŒæ ·å‚ä¸æ¯”è¾ƒ */
      z-index: 1;
    }

    /* ä½ å·²æœ‰çš„è¿™ä¸¤æ¡ä¿ç•™/ç¡®è®¤æ›´é«˜å±‚çº§ */
    .cat-picker { position: relative; z-index: 200; }
    .cat-menu   { position: absolute; z-index: 9999; }

  </style>

  </head>
  <body>
    <div class="container-panel">
      <h1 class="page-title">
        åˆ†ç±»å¾…åŠäº‹é¡¹
      </h1>
      <p class="page-subtitle">æŒ‰åˆ†ç±»ç®¡ç†ã€ç»Ÿè®¡ä¸æŒä¹…åŒ–çš„æç®€å¾…åŠæ¸…å•</p>
      
      <!-- æ·»åŠ ä»»åŠ¡çš„åŒºåŸŸ -->
      <div class="row">
        <input type="text" id="taskInput" placeholder="è¾“å…¥æ–°çš„å¾…åŠäº‹é¡¹â€¦â€¦">

        <!-- æ–°å¢ï¼šåˆ†ç±»é€‰æ‹© -->
        <select id="categorySelect">
          <option value="å·¥ä½œ">å·¥ä½œ</option>
          <option value="å­¦ä¹ ">å­¦ä¹ </option>
          <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
          <option value="è´­ç‰©">è´­ç‰©</option>
          <option value="å…¶ä»–">å…¶ä»–</option>
        </select>

        <button id="addButton" class="btn">æ·»åŠ ä»»åŠ¡</button>
      </div>

      <!-- æ–°å¢ï¼šåˆ†ç±»ç­›é€‰æ ‡ç­¾ -->
      <div id="filters">
        <button data-filter="å…¨éƒ¨">å…¨éƒ¨</button>
        <button data-filter="å·¥ä½œ">å·¥ä½œ</button>
        <button data-filter="å­¦ä¹ ">å­¦ä¹ </button>
        <button data-filter="ç”Ÿæ´»">ç”Ÿæ´»</button>
        <button data-filter="è´­ç‰©">è´­ç‰©</button>
        <button data-filter="å…¶ä»–">å…¶ä»–</button>
      </div>

      <!-- è‡ªå®šä¹‰åˆ†ç±»ï¼šæ–°å¢è¡¨å• -->
      <div id="customCatForm" class="cat-form">
        <input type="text" id="newCategoryInput" class="cat-input" placeholder="è¾“å…¥æ–°åˆ†ç±»åç§°">
        <button id="addCategoryBtn" class="btn cat-add">æ·»åŠ åˆ†ç±»</button>
      </div>

      <!-- è‡ªå®šä¹‰åˆ†ç±»ï¼šå±•ç¤ºåŒºï¼ˆç¨åç”¨ JS å¡«å†…å®¹ï¼‰ -->
      <div id="customCats" class="cat-list">æš‚æ— è‡ªå®šä¹‰åˆ†ç±»</div>

      <div id="currentFilter">å½“å‰ç­›é€‰ï¼šå…¨éƒ¨</div>

      <!-- æ˜¾ç¤ºä»»åŠ¡çš„åŒºåŸŸ -->
      <ul id="taskList">
        <!-- å°†æ¥ä»»åŠ¡ä¼šå‡ºç°åœ¨è¿™é‡Œ -->
      </ul>

      <!-- ç»Ÿè®¡æ˜¾ç¤º -->
      <div id="stats">æ€»æ•°ï¼š0 ï½œ å·²å®Œæˆï¼š0</div>
    </div>

    <script>
      // â€”â€” åº”ç”¨çŠ¶æ€ï¼ˆå”¯ä¸€çœŸç›¸ï¼‰â€”â€”
      let tasks = []; // æ¯ä¸ªä»»åŠ¡ï¼š{ id: number, text: string, completed: boolean }
      const STORAGE_KEY = 'my_todos_v1';
      // æ–°å¢ï¼šå½“å‰ç­›é€‰ï¼ˆé»˜è®¤â€œå…¨éƒ¨â€ï¼‰
      let currentFilter = 'å…¨éƒ¨';
      let customCategories = [];
      const STORAGE_KEY_CATS = 'my_todos_cats_v1';
      const RESERVED = new Set(['å…¨éƒ¨','å·¥ä½œ','å­¦ä¹ ','ç”Ÿæ´»','è´­ç‰©','å…¶ä»–']);

      function highlightActiveFilter() {
        const buttons = document.querySelectorAll('#filters button[data-filter]');
        buttons.forEach(btn => {
          if (btn.dataset.filter === currentFilter) btn.classList.add('is-active');
          else btn.classList.remove('is-active');
        });
      }

      function getVisible() {
        return (currentFilter === 'å…¨éƒ¨')
          ? tasks
          : tasks.filter(t => t.category === currentFilter);
      }

      function computeStats(arr) {
        const total = arr.length;
        const done = arr.filter(t => t.completed).length;
        return { total, done };
      }

      function save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
      }

      function updateStats() {
        const statsDiv = document.getElementById('stats');
        const total = tasks.length;
        const done = tasks.filter(t => t.completed).length;
        statsDiv.textContent = `æ€»æ•°ï¼š${total} ï½œ å·²å®Œæˆï¼š${done}`;
      }

      // ä»…æ›´æ–°è‡ªå®šä¹‰åˆ†ç±» chips ä¸Šçš„æ•°é‡å¾½ç« ï¼Œä¸é‡å»º DOM
      function updateCategoryBadges() {
        // æ‰¾åˆ°æ‰€æœ‰ chipï¼ˆæ¯ä¸ª chip é‡Œï¼š.chip-goto æ˜¯åç§°ï¼Œ.chip-badge æ˜¯æ•°å­—ï¼‰
        document.querySelectorAll('#customCats .chip').forEach(chip => {
          const nameEl = chip.querySelector('.chip-goto');
          const badgeEl = chip.querySelector('.chip-badge');
          if (!nameEl || !badgeEl) return;
          const cat = nameEl.textContent;
          // ç»Ÿè®¡è¯¥åˆ†ç±»ä¸‹ä»»åŠ¡æ€»æ•°ï¼ˆä¸åŒºåˆ†å®Œæˆä¸å¦ï¼‰
          const count = tasks.filter(t => t.category === cat).length;
          badgeEl.textContent = count;
        });
      }

      function deleteCustomCategory(cat) {
        if (!customCategories.includes(cat)) return;
        const ok = confirm(`ç¡®å®šåˆ é™¤åˆ†ç±»ã€Œ${cat}ã€å—ï¼Ÿ\nè¯¥åˆ†ç±»ä¸‹çš„ä»»åŠ¡å°†è‡ªåŠ¨ç§»åŠ¨åˆ°ã€Œå…¶ä»–ã€ã€‚`);
        if (!ok) return;

        // 1) ä»è‡ªå®šä¹‰åˆ†ç±»åˆ—è¡¨ç§»é™¤
        customCategories = customCategories.filter(c => c !== cat);
        saveCats();

        // 2) è¿ç§»ä»»åŠ¡ï¼šå‡¡æ˜¯è¿™ä¸ªåˆ†ç±»çš„ï¼Œæ”¹æˆâ€œå…¶ä»–â€
        let changed = false;
        tasks = tasks.map(t => {
          if (t.category === cat) {
            changed = true;
            return { ...t, category: 'å…¶ä»–' };
          }
          return t;
        });
        if (changed) save();

        // 3) å¦‚æœå½“å‰å°±åœ¨è¿™ä¸ªåˆ†ç±»çš„ç­›é€‰é‡Œï¼Œåˆ‡å›â€œå…¨éƒ¨â€
        if (currentFilter === cat) currentFilter = 'å…¨éƒ¨';

        // å¦‚æœæ·»åŠ ä»»åŠ¡ç”¨çš„ select ä¹Ÿé€‰ä¸­äº†è¿™ä¸ªåˆ†ç±»ï¼Œå›é€€åˆ°â€œå…¶ä»–â€
        const sel = document.getElementById('categorySelect');
        if (sel && sel.value === cat) {
          sel.value = 'å…¶ä»–';
          enhanceCategorySelect.syncLabel && enhanceCategorySelect.syncLabel();
        }

        // 4) ç»Ÿä¸€é‡æ¸²æŸ“
        renderFilters();
        render();
      }

      // åˆ†ç±»å -> å¾½ç­¾é¢œè‰²ç±»
      function getTagClass(cat) {
        switch (cat) {
          case 'å·¥ä½œ': return 'tag-work';
          case 'å­¦ä¹ ': return 'tag-study';
          case 'ç”Ÿæ´»': return 'tag-life';
          case 'è´­ç‰©': return 'tag-shop';
          case 'å…¶ä»–': return 'tag-other';
          default:
            // è‡ªå®šä¹‰åˆ†ç±»ï¼šç”¨åç§°åšä¸ªç®€å• hashï¼Œç¨³å®šè½åœ¨ 0~5
            let h = 0;
            for (let i = 0; i < cat.length; i++) h = (h * 31 + cat.charCodeAt(i)) >>> 0;
            const idx = h % 6;
            return `tag-c${idx}`;
        }
      }

      // ï¼ˆå¯é€‰ï¼‰å›ºå®šåˆ†ç±»çš„å° Emoji
      function getTagIcon(cat) {
        switch (cat) {
          case 'å·¥ä½œ': return 'ğŸ§°';
          case 'å­¦ä¹ ': return 'ğŸ“š';
          case 'ç”Ÿæ´»': return 'ğŸ¡';
          case 'è´­ç‰©': return 'ğŸ›ï¸';
          case 'å…¶ä»–': return 'ğŸ—‚ï¸';
          default:     return 'ğŸ·ï¸';
        }
      }

      // æ‰€æœ‰åˆ†ç±»ï¼ˆå›ºå®š + è‡ªå®šä¹‰ï¼‰
      function getAllCategories() {
        return ['å·¥ä½œ','å­¦ä¹ ','ç”Ÿæ´»','è´­ç‰©','å…¶ä»–', ...customCategories];
      }

      // ç»™æŸä¸ªåˆ†ç±»ç”Ÿæˆä¸€æ¡èœå•é¡¹ DOM
      function createCatOption(cat, currentValue, onSelect) {
        const opt = document.createElement('div');
        opt.className = 'cat-option' + (cat === currentValue ? ' active' : '');

        const dot = document.createElement('span');
        dot.className = `cat-dot ${getTagClass(cat)}`;

        const label = document.createElement('span');
        label.textContent = cat;

        opt.appendChild(dot);
        opt.appendChild(label);

        opt.addEventListener('click', () => onSelect(cat));
        return opt;
      }

      // è‡ªå®šä¹‰é€‰æ‹©å™¨ï¼šåªåˆ›å»ºä¸€æ¬¡ï¼Œä¹‹åé‡å»ºèœå•å†…å®¹å³å¯
      let catPickerRoot = null;
      let catMenu = null;
      let catBtn = null;

      function enhanceCategorySelect() {
        const select = document.getElementById('categorySelect');
        if (!select) return;

        // å·²ç»å¢å¼ºè¿‡å°±è·³è¿‡
        if (catPickerRoot) { rebuildCatMenu(); syncCatBtnLabel(); return; }

        // 1) éšè—åŸç”Ÿ select
        select.classList.add('select-hidden');

        // 2) æ„å»ºå®¹å™¨ + æŒ‰é’® + èœå•
        catPickerRoot = document.createElement('div');
        catPickerRoot.className = 'cat-picker';

        catBtn = document.createElement('button');
        catBtn.type = 'button';
        catBtn.className = 'cat-picker-btn';

        // æŒ‰é’®é‡Œçš„ï¼šå½©è‰²ç‚¹ + æ–‡æœ¬ + ç®­å¤´
        const btnDot = document.createElement('span'); btnDot.className = 'cat-dot';
        const btnLabel = document.createElement('span'); btnLabel.className = 'cat-label';
        const btnCaret = document.createElement('span'); btnCaret.className = 'cat-caret';
        catBtn.append(btnDot, btnLabel, btnCaret);

        catMenu = document.createElement('div');
        catMenu.className = 'cat-menu';

        catPickerRoot.append(catBtn, catMenu);

        // 3) æŠŠé€‰æ‹©å™¨æ’åˆ° select åé¢
        select.parentNode.insertBefore(catPickerRoot, select.nextSibling);

        // 4) äº¤äº’ï¼šå¼€å…³èœå•
        catBtn.addEventListener('click', () => {
          const willShow = !catMenu.classList.contains('show');
          if (willShow) {
            // è®¡ç®—ç©ºé—´ï¼šä¸‹é¢ vs ä¸Šé¢
            const rect = catBtn.getBoundingClientRect();
            const spaceBelow = window.innerHeight - rect.bottom;
            const spaceAbove = rect.top;
            const preferUp = spaceBelow < 180 && spaceAbove > spaceBelow; // é˜ˆå€¼å¯è°ƒ

            catMenu.classList.toggle('drop-up', preferUp);
          }
          catMenu.classList.toggle('show');
        });

        // ç‚¹å‡»å¤–é¢å…³é—­
        document.addEventListener('click', (e) => {
          if (!catPickerRoot.contains(e.target)) catMenu.classList.remove('show');
        });
        // Esc å…³é—­
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') catMenu.classList.remove('show');
        });

        // åˆæ¬¡å†…å®¹
        rebuildCatMenu();
        syncCatBtnLabel();

        function rebuildCatMenu() {
          catMenu.innerHTML = '';
          const value = select.value || 'å·¥ä½œ';
          getAllCategories().forEach(cat => {
            const node = createCatOption(cat, value, (chosen) => {
              // 1) æ›´æ–°åŸç”Ÿ select
              select.value = chosen;
              // 2) æ›´æ–°æŒ‰é’®æ˜¾ç¤º
              syncCatBtnLabel();
              // 3) å…³é—­èœå•
              catMenu.classList.remove('show');
            });
            catMenu.appendChild(node);
          });
        }
        // æš´éœ²ç»™å¤–éƒ¨ï¼ˆä¾‹å¦‚è‡ªå®šä¹‰åˆ†ç±»å˜åŒ–åé‡å»ºï¼‰
        enhanceCategorySelect.rebuild = rebuildCatMenu;

        function syncCatBtnLabel() {
          const value = select.value || 'å·¥ä½œ';
          const dotClass = getTagClass(value);
          btnDot.className = `cat-dot ${dotClass}`;
          btnLabel.textContent = value;
        }
        // æš´éœ²
        enhanceCategorySelect.syncLabel = syncCatBtnLabel;
      }

      function renderFilters() {
        // 1) é‡å»º <select> é€‰é¡¹
        const select = document.getElementById('categorySelect');
        const fixedValues = ['å·¥ä½œ','å­¦ä¹ ','ç”Ÿæ´»','è´­ç‰©','å…¶ä»–'];

        select.innerHTML = '';
        fixedValues.forEach(v => {
          const opt = document.createElement('option');
          opt.value = v; opt.textContent = v;
          select.appendChild(opt);
        });
        customCategories.forEach(cat => {
          const opt = document.createElement('option');
          opt.value = cat; opt.textContent = cat;
          select.appendChild(opt);
        });

        /* === æ–°å¢ï¼šæ— è®ºå¦‚ä½•éƒ½å…ˆé‡å»ºâ€œè‡ªå®šä¹‰é€‰æ‹©å™¨â€çš„èœå• & åŒæ­¥æŒ‰é’® === */
        if (enhanceCategorySelect.rebuild) {
          enhanceCategorySelect.rebuild();

          // å¦‚æœå½“å‰ select.value ä¸åœ¨ options é‡Œï¼ˆè¢«åˆ é™¤äº†ï¼‰ï¼Œå›é€€åˆ°â€œå…¶ä»–â€
          const exists = [...select.options].some(o => o.value === select.value);
          if (!exists) select.value = 'å…¶ä»–';

          enhanceCategorySelect.syncLabel && enhanceCategorySelect.syncLabel();
        }
        /* === æ–°å¢ç»“æŸ === */

        // 2) æ¸²æŸ“ chips
        const wrap = document.getElementById('customCats');
        wrap.innerHTML = '';

        if (customCategories.length === 0) {
          wrap.textContent = 'æš‚æ— è‡ªå®šä¹‰åˆ†ç±»';
          return; // è¿™é‡Œå¯ä»¥ä¿ç•™ returnï¼ˆä¸Šé¢å·²ç»åšäº†é‡å»ºï¼‰
        }

        customCategories.forEach(cat => {
          const chip = document.createElement('span');
          chip.className = 'chip';

          const go = document.createElement('button');
          go.className = 'chip-goto';
          go.textContent = cat;
          go.addEventListener('click', () => {
            currentFilter = cat;
            highlightActiveFilter?.();
            render();
          });

          const badge = document.createElement('span');
          badge.className = 'chip-badge';
          badge.textContent = tasks.filter(t => t.category === cat).length;

          const del = document.createElement('button');
          del.className = 'chip-del';
          del.textContent = 'Ã—';
          del.title = `åˆ é™¤åˆ†ç±»ã€Œ${cat}ã€`;
          del.addEventListener('click', () => deleteCustomCategory(cat));

          chip.appendChild(go);
          chip.appendChild(badge);
          chip.appendChild(del);
          wrap.appendChild(chip);
        });
      }
      
      function render() {
        list.innerHTML = '';

        // è®¡ç®—å¯è§åˆ—è¡¨
        const visible = getVisible();

        // ç©ºæ€
        if (visible.length === 0) {
          const li = document.createElement('li');
          li.innerHTML = '<div class="empty">æš‚æ— ä»»åŠ¡ï¼ˆæˆ–å½“å‰åˆ†ç±»ä¸‹æš‚æ— ä»»åŠ¡ï¼‰</div>';
          list.appendChild(li);
        } else {
          // æ¸²æŸ“å¯è§é¡¹
          visible.forEach(task => {
            const li = document.createElement('li');
            li.classList.add(`cat-${task.category}`);

            const check = document.createElement('input');
            check.type = 'checkbox';
            check.checked = task.completed;

            // ä¸€è¡Œï¼šå·¦è¾¹æ˜¯åˆ†ç±»å¾½ç­¾ï¼Œå³è¾¹æ˜¯å¯æ‰“åˆ é™¤çº¿çš„æ–‡æœ¬
            const line = document.createElement('div');
            line.className = 'task-line';

            // åˆ†ç±»å¾½ç­¾
            const tag = document.createElement('span');
            tag.className = `tag ${getTagClass(task.category)}`;
            const ico = document.createElement('span');
            ico.className = 'tag-ico';
            ico.textContent = getTagIcon(task.category);
            const tagText = document.createElement('span');
            tagText.textContent = task.category;
            tag.appendChild(ico);
            tag.appendChild(tagText);

            // æ–‡æœ¬
            const span = document.createElement('span');
            span.className = 'task-text';
            span.textContent = task.text;
            if (task.completed) span.classList.add('completed');

            // ç»„è£…
            line.appendChild(tag);
            line.appendChild(span);
            li.appendChild(line);

            const del = document.createElement('button');
            del.textContent = 'åˆ é™¤';
            del.className = 'btn-del';

            check.addEventListener('change', () => {
              task.completed = check.checked;
              save();
              render(); // åªéœ€ render
            });

            del.addEventListener('click', () => {
              tasks = tasks.filter(t => t.id !== task.id);
              save();
              render(); // åªéœ€ render
            });

            li.appendChild(check);
            li.appendChild(del);
            list.appendChild(li);
          });
        }

        // æ›´æ–°â€œå½“å‰ç­›é€‰â€æç¤º
        if (currentFilterDiv) {
          currentFilterDiv.textContent = `å½“å‰ç­›é€‰ï¼š${currentFilter}`;
        }

        // â€”â€” ç»Ÿä¸€æ›´æ–°ä¸¤ç§ç»Ÿè®¡ â€”â€” 
        const statsCurrentDiv = document.getElementById('statsCurrent');
        const { total: tc, done: dc } = computeStats(visible);
        if (statsCurrentDiv) {
          statsCurrentDiv.textContent = `å½“å‰åˆ†ç±»ï¼šæ€»æ•°ï¼š${tc} ï½œ å·²å®Œæˆï¼š${dc}`;
        }

        const statsDiv = document.getElementById('stats');
        const { total, done } = computeStats(tasks);
        if (statsDiv) {
          statsDiv.textContent = `æ€»æ•°ï¼š${total} ï½œ å·²å®Œæˆï¼š${done}`;
        }

        updateCategoryBadges();
      }
    
      // è·å–é¡µé¢å…ƒç´ 
      const input = document.getElementById('taskInput'); // è¾“å…¥æ¡†
      const button = document.getElementById('addButton'); // æŒ‰é’®
      const list = document.getElementById('taskList'); // åˆ—è¡¨
      const categorySelect = document.getElementById('categorySelect');
      const currentFilterDiv = document.getElementById('currentFilter');
      const filtersDiv = document.getElementById('filters');


      // ç»™æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶
      button.addEventListener('click', function () {
        const text = input.value.trim();
        if (!text) { alert('è¯·è¾“å…¥å†…å®¹'); return; }

        // å¾€â€œçŠ¶æ€â€é‡ŒåŠ ä¸€æ¡
        tasks.push({
          id: Date.now(),
          text,
          completed: false,
          category: categorySelect.value   // æ–°å¢å­—æ®µ
        });

        // ä¿å­˜ â†’ æ¸²æŸ“
        save();
        render();

        input.value = '';
        input.focus();
      });

      const newCategoryInput = document.getElementById('newCategoryInput');
      const addCategoryBtn = document.getElementById('addCategoryBtn');

      function saveCats() {
        localStorage.setItem(STORAGE_KEY_CATS, JSON.stringify(customCategories));
      }

      addCategoryBtn.addEventListener('click', () => {
        const name = (newCategoryInput.value || '').trim();
        if (!name) {
          newCategoryInput.classList.add('error');
          setTimeout(() => newCategoryInput.classList.remove('error'), 350);
          alert('è¯·è¾“å…¥åˆ†ç±»åç§°');
          return; 
        }
        
        if (RESERVED.has(name)) {
          newCategoryInput.classList.add('error');
          setTimeout(() => newCategoryInput.classList.remove('error'), 350);
          alert('è¿™æ˜¯ä¿ç•™åˆ†ç±»ï¼Œä¸èƒ½é‡å¤æ·»åŠ ');
          return; 
        }

        if (customCategories.includes(name)) {
          newCategoryInput.classList.add('error');
          setTimeout(() => newCategoryInput.classList.remove('error'), 350);
          alert('è¯¥åˆ†ç±»å·²å­˜åœ¨'); 
          return; 
        }

        customCategories.push(name);
        saveCats();
        renderFilters();  // æ›´æ–°ä¸‹æ‹‰å’Œå±•ç¤ºåŒº

        const form = document.getElementById('customCatForm');
        form.classList.remove('flash'); // å…ˆç§»é™¤é˜²æ­¢è¿ç‚¹æ— æ•ˆ
        void form.offsetWidth;          // è§¦å‘é‡ç»˜ä»¥é‡å¯åŠ¨ç”»
        form.classList.add('flash');

        newCategoryInput.value = '';
      });

      // å›è½¦æ·»åŠ 
      newCategoryInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') addCategoryBtn.click();
      });

      // æŒ‰ Enter ç›´æ¥æ·»åŠ ä»»åŠ¡
      input.addEventListener('keydown', function (e) {
          if (e.key === 'Enter') {
              button.click(); // è§¦å‘â€œæ·»åŠ ä»»åŠ¡â€å’Œåç»­æ¸²æŸ“/ç»Ÿè®¡
          }
      });

      document.addEventListener('DOMContentLoaded', () => {
        // 1) å…ˆä» localStorage è¯»å–
        const raw = localStorage.getItem(STORAGE_KEY);
        tasks = raw ? JSON.parse(raw) : [];

        // è¯»å–è‡ªå®šä¹‰åˆ†ç±»
        try {
          const rawCats = localStorage.getItem(STORAGE_KEY_CATS);
          customCategories = rawCats ? JSON.parse(rawCats) : [];
        } catch {
          customCategories = [];
          localStorage.removeItem(STORAGE_KEY_CATS);
        }
        
        renderFilters();

        // 2) æ¸²æŸ“ + ç»Ÿè®¡
        render();

        enhanceCategorySelect();

        // é¡µé¢åŠ è½½å®Œä¹Ÿåˆå§‹åŒ–ä¸€æ¬¡é«˜äº®
        highlightActiveFilter();
      });

      // äº‹ä»¶å§”æ‰˜ï¼šfilters å®¹å™¨é‡Œç‚¹åˆ°å“ªä¸ªæŒ‰é’®éƒ½èƒ½æ‹¿åˆ° data-filter
      filtersDiv.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-filter]');
        if (!btn) return;
        currentFilter = btn.dataset.filter; // è¯»å– data-filter çš„å€¼
        render();
        updateStats();

        // åŒæ­¥å³è¾¹çš„â€œå¾…åŠç§ç±»é€‰æ‹©å™¨â€
        const cat = currentFilter;
        const select = document.getElementById('categorySelect');
        if (select) {
          select.value = cat === 'å…¨éƒ¨' ? 'å·¥ä½œ' : cat; // â€œå…¨éƒ¨â€æ—¶ä¿æŒé»˜è®¤â€œå·¥ä½œâ€
          if (enhanceCategorySelect.syncLabel) enhanceCategorySelect.syncLabel();
        }
      });

    </script>
  </body>
</html>
