<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„ç¬¬ä¸€ä¸ªå¾…åŠé¡µé¢</title>
  </head>
  <body>
    <h1>ğŸ“‹ åˆ†ç±»å¾…åŠäº‹é¡¹</h1>
    
    <!-- æ·»åŠ ä»»åŠ¡çš„åŒºåŸŸ -->
    <div>
      <input type="text" id="taskInput" placeholder="è¾“å…¥æ–°çš„å¾…åŠäº‹é¡¹â€¦â€¦">

      <!-- æ–°å¢ï¼šåˆ†ç±»é€‰æ‹© -->
      <select id="categorySelect">
        <option value="å·¥ä½œ">å·¥ä½œ</option>
        <option value="å­¦ä¹ ">å­¦ä¹ </option>
        <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
        <option value="è´­ç‰©">è´­ç‰©</option>
        <option value="å…¶ä»–">å…¶ä»–</option>
      </select>

      <button id="addButton">æ·»åŠ ä»»åŠ¡</button>
    </div>

    <!-- æ–°å¢ï¼šåˆ†ç±»ç­›é€‰æ ‡ç­¾ -->
    <div id="filters">
      <button data-filter="å…¨éƒ¨">å…¨éƒ¨</button>
      <button data-filter="å·¥ä½œ">å·¥ä½œ</button>
      <button data-filter="å­¦ä¹ ">å­¦ä¹ </button>
      <button data-filter="ç”Ÿæ´»">ç”Ÿæ´»</button>
      <button data-filter="è´­ç‰©">è´­ç‰©</button>
      <button data-filter="å…¶ä»–">å…¶ä»–</button>
    </div>
    <div id="currentFilter">å½“å‰ç­›é€‰ï¼šå…¨éƒ¨</div>

    <!-- æ˜¾ç¤ºä»»åŠ¡çš„åŒºåŸŸ -->
    <ul id="taskList">
      <!-- å°†æ¥ä»»åŠ¡ä¼šå‡ºç°åœ¨è¿™é‡Œ -->
    </ul>

    <!-- ç»Ÿè®¡æ˜¾ç¤º -->
    <div id="stats">æ€»æ•°ï¼š0 ï½œ å·²å®Œæˆï¼š0</div>

    <script>
      // â€”â€” åº”ç”¨çŠ¶æ€ï¼ˆå”¯ä¸€çœŸç›¸ï¼‰â€”â€”
      let tasks = []; // æ¯ä¸ªä»»åŠ¡ï¼š{ id: number, text: string, completed: boolean }
      const STORAGE_KEY = 'my_todos_v1';
      // æ–°å¢ï¼šå½“å‰ç­›é€‰ï¼ˆé»˜è®¤â€œå…¨éƒ¨â€ï¼‰
      let currentFilter = 'å…¨éƒ¨';

      function getVisible() {
        return (currentFilter === 'å…¨éƒ¨')
          ? tasks
          : tasks.filter(t => t.category === currentFilter);
      }

      function computeStats(arr) {
        const total = arr.length;
        const done = arr.filter(t => t.completed).length;
        return { total, done };
      }

      function save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
      }

      function updateStats() {
        const statsDiv = document.getElementById('stats');
        const total = tasks.length;
        const done = tasks.filter(t => t.completed).length;
        statsDiv.textContent = `æ€»æ•°ï¼š${total} ï½œ å·²å®Œæˆï¼š${done}`;
      }
      
      function render() {
        list.innerHTML = '';

        // è®¡ç®—å¯è§åˆ—è¡¨
        const visible = getVisible();

        // ç©ºæ€
        if (visible.length === 0) {
          const li = document.createElement('li');
          li.textContent = 'æš‚æ— ä»»åŠ¡ï¼ˆæˆ–å½“å‰åˆ†ç±»ä¸‹æš‚æ— ä»»åŠ¡ï¼‰';
          li.style.color = '#777';
          list.appendChild(li);
        } else {
          // æ¸²æŸ“å¯è§é¡¹
          visible.forEach(task => {
            const li = document.createElement('li');

            const check = document.createElement('input');
            check.type = 'checkbox';
            check.checked = task.completed;

            const span = document.createElement('span');
            span.textContent = `[${task.category}] ${task.text}`;
            if (task.completed) {
              span.style.textDecoration = 'line-through';
              span.style.color = '#777';
            }

            const del = document.createElement('button');
            del.textContent = 'åˆ é™¤';

            check.addEventListener('change', () => {
              task.completed = check.checked;
              save();
              render(); // åªéœ€ render
            });

            del.addEventListener('click', () => {
              tasks = tasks.filter(t => t.id !== task.id);
              save();
              render(); // åªéœ€ render
            });

            li.appendChild(check);
            li.appendChild(span);
            li.appendChild(del);
            list.appendChild(li);
          });
        }

        // æ›´æ–°â€œå½“å‰ç­›é€‰â€æç¤º
        if (currentFilterDiv) {
          currentFilterDiv.textContent = `å½“å‰ç­›é€‰ï¼š${currentFilter}`;
        }

        // â€”â€” ç»Ÿä¸€æ›´æ–°ä¸¤ç§ç»Ÿè®¡ â€”â€” 
        const statsCurrentDiv = document.getElementById('statsCurrent');
        const { total: tc, done: dc } = computeStats(visible);
        if (statsCurrentDiv) {
          statsCurrentDiv.textContent = `å½“å‰åˆ†ç±»ï¼šæ€»æ•°ï¼š${tc} ï½œ å·²å®Œæˆï¼š${dc}`;
        }

        const statsDiv = document.getElementById('stats');
        const { total, done } = computeStats(tasks);
        if (statsDiv) {
          statsDiv.textContent = `æ€»æ•°ï¼š${total} ï½œ å·²å®Œæˆï¼š${done}`;
        }
      }
    
      // è·å–é¡µé¢å…ƒç´ 
      const input = document.getElementById('taskInput'); // è¾“å…¥æ¡†
      const button = document.getElementById('addButton'); // æŒ‰é’®
      const list = document.getElementById('taskList'); // åˆ—è¡¨
      const categorySelect = document.getElementById('categorySelect');
      const currentFilterDiv = document.getElementById('currentFilter');
      const filtersDiv = document.getElementById('filters');


      // ç»™æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶
      button.addEventListener('click', function () {
        const text = input.value.trim();
        if (!text) { alert('è¯·è¾“å…¥å†…å®¹'); return; }

        // å¾€â€œçŠ¶æ€â€é‡ŒåŠ ä¸€æ¡
        tasks.push({
          id: Date.now(),
          text,
          completed: false,
          category: categorySelect.value   // æ–°å¢å­—æ®µ
        });

        // ä¿å­˜ â†’ æ¸²æŸ“
        save();
        render();

        input.value = '';
        input.focus();
      });

      // æŒ‰ Enter ç›´æ¥æ·»åŠ ä»»åŠ¡
      input.addEventListener('keydown', function (e) {
          if (e.key === 'Enter') {
              button.click(); // è§¦å‘â€œæ·»åŠ ä»»åŠ¡â€å’Œåç»­æ¸²æŸ“/ç»Ÿè®¡
          }
      });

      document.addEventListener('DOMContentLoaded', () => {
        // 1) å…ˆä» localStorage è¯»å–
        const raw = localStorage.getItem(STORAGE_KEY);
        tasks = raw ? JSON.parse(raw) : [];

        // 2) æ¸²æŸ“ + ç»Ÿè®¡
        render();
      });

      // äº‹ä»¶å§”æ‰˜ï¼šfilters å®¹å™¨é‡Œç‚¹åˆ°å“ªä¸ªæŒ‰é’®éƒ½èƒ½æ‹¿åˆ° data-filter
      filtersDiv.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-filter]');
        if (!btn) return;
        currentFilter = btn.dataset.filter; // è¯»å– data-filter çš„å€¼
        render();
      });

    </script>
  </body>
</html>
